---
title: "Prolific percentage compute"
output: html_notebook
---

Dated July 2020
by D V M Bishop

Script to compute for individual journals the percentage of publications contributed by the most prolific author.
Now modified to make a datatable with all authors who published 15+ papers in 5 year period


```{r setup, include=FALSE}
require(tidyverse)
require(gdata)
require(dmm) #for unfactor
require(stringr)
require(varhandle) #for unfactor
```
# Background
The script uses the wosr package. With this, it is possible to obtain a link that allows one to pull in records from queries to Web of Science, provided the IP address has a legitmate WoS licence.  
https://www.rdocumentation.org/packages/wosr/versions/0.3.0

# Journals
We make lists to focus on behavioural sciences/psychology by specific publishers



```{r springerlist}

myj <- c('journal of environmental health science and engineering','International Journal of Bipolar Disorders','Molecular Autism','Behavior Research Methods','Quality of life research','Neuropsychopharmacology','Current Obesity Reports','Educational Psychology Review','Neuropsychology Review','International Journal of Computer-Supported Collaborative Learning','European Child and Adolescent Psychiatry','Psychonomic Bulletin and Review','Harm Reduction Journal','Rheumatology and Therapy','Mindfulness','PharmacoEconomics','Journal of Neurodevelopmental Disorders','Clinical Child and Family Psychology Review','Brain Imaging and Behavior','Journal of Cancer Survivorship','Journal of Business and Psychology','The Patient','AIDS and behavior','Archives of Sexual Behavior','Journal of Youth and Adolescence','Prevention Science','Addiction Science and Clinical Practice','Journal of Autism and Developmental Disorders','Cognitive Neurodynamics','Translational Behavioral Medicine','Journal of Behavioral Medicine','Annals of Behavioral Medicine','Journal of Abnormal Child Psychology','Animal Cognition','Journal of Gambling Studies','Journal of Eating Disorders','Journal of Nutrition, Health and Aging','Dermatology and therapy','BMC Psychiatry','Cognitive Therapy and Research','International Journal for Equity in Health','Archives of Womens Mental Health','Applied Health Economics and Health Policy', 'Psychological Research','European Journal of Ageing','Sex Roles','Sexuality Research and Social Policy','Journal of Happiness Studies','Health and Quality of life outcomes','Administration and policy in mental health and mental health services','behavior genetics','human nature','cognitive, affective, and behavioral neuroscience','international journal of mental health systems','journal of occupational rehabilitation','annals of general psychiatry','international journal of behavioral medicine','behavioral and brain functions','bmc psychiatry','borderline personality disorder and emotion dysregulation','child and adolescent psychiatry and mental health','journal of psychopathology and behavioral assessment','bmc palliative care','substance abuse treatment, prevention and policy','psychmetrika','school mental health','attention, perception and psychophysics','child psychiatry and human development','motivation and emotion','social indicators research','minds and machines','journal of nonverbal behavior','instructional science','the journal of primary prevention','memory and cognition','applied research in quality of life','computer supported cooperative work','zorg and welzijn','zeitschrift fur psychodrama und soziometrie','journal of human rights and social work' )

#subset that had been missed
#check names on WOS - in many cases need to remove 'and' for title to getmatch
myj2<-c("European Child Adolescent Psychiatry", "Psychonomic Bulletin Review", "Addiction Science Clinical Practice", "Journal of Nutrition, Health Aging", "psychological research psychologische forschung", "Administration and policy in mental health and mental health services research", "cognitive affective behavioral neuroscience", "Psychometrika", "Attention perception psychophysics", "child psychiatry human development", "journal of primary prevention", "memory cognition", "zorg welzijn")

#Not on manual WOS: The Patient, Human Nature (many subvarieties with this title),
#primary prevention: (more than one starting with this), zeitschrift fur psychodrama und soziometrie

#Last tranche: remaining journals (webpage from 4-12)
myj3 <- c("Journal of Human Rights and Social Work", 
         "Journal of Well-Being Assessment", 
         "Global Social Welfare", 
         "Childhood Vulnerability Journal", 
         "Tijdschrift voor Psychotherapie", 
         "The Analysis of Verbal Behavior", 
         "Quality and User Experience", 
         "The Urban Review", 
         "Trends in Psychology", 
         "Education and Treatment of Children", 
         "Journal of Child & Adolescent Trauma", 
         "Contemporary Family Therapy", 
         "American Journal of Dance Therapy", 
         "Pulmonary Therapy", 
         "Biological Theory", 
         "Coaching Theorie & Praxis", 
         "Measurement Instruments for the Social Sciences",
         "Phenomenology and the Cognitive Sciences", 
         "The American Journal of Psychoanalysis", 
         "International Journal for the Advancement of Counselling",
         "Bulletin of the Psychonomic Society",
         "Journal of Technology in Behavioral Science",
         "Organisationsberatung, Supervision, Coaching", 
         "Activitas Nervosa Superior", 
         "Psychological Studies", 
         "Soziale Passagen", 
         "Soziale Probleme", 
         "Sozial Extra", 
         "Somnologie", 
         "Mind & Society", 
         "Psychoanalysis, Culture & Society", 
         "International Journal of Politics, Culture, and Society",
         "Behavior and Social Issues", 
         "SN Social Sciences", 
         "Sexuality & Culture", 
         "Journal of Health Service Psychology", 
         "Occupational Health Science", 
         "Evolutionary Psychological Science", 
         "Computational Cognitive Science", 
         "Journal of Cultural Cognitive Science", 
         "Adversity and Resilience Science", 
         "Affective Science", 
         "Crime Science", 
         "Contemporary School Psychology", 
         "Adolescent Research Review", 
         "Review of Philosophy and Psychology", "Cognitive Research: Principles and Implications",
 "Augmented Human Research",
 "Journal of Policy Practice and Research",
 "Global Implementation Research and Applications",
 "Neurological Research and Practice",
 "Current Behavioral Neuroscience Reports",
 "Journal of Patient-Reported Outcomes",
 "Journal of Psychosocial Rehabilitation and Mental Health",
 "cultura & psyché",
 "Journal of Contemporary Psychotherapy",
 "Psychotherapie Forum",
 "psychopraxis. neuropraxis",
 "Psychopraktijk",
 "Pastoral Psychology",
 "International Journal of Applied Positive Psychology",
 "Journal of Police and Criminal Psychology",
 "BMC Psychology",
 "GZ - Psychologie",
 "Psychological Injury and Law",
 "InFo Neurologie + Psychiatrie",
 "DNP - Der Neurologe & Psychiater",
 "International Journal of Bullying Prevention",
 "Kind & Adolescent Praktijk",
 "Behavior Analysis in Practice",
 "Adaptive Human Behavior and Physiology",
 "PharmacoEconomics & Outcomes News",
 "Leadership, Education, Personality",
 "Journal of Pediatric Neuropsychology",
 "Pallium",
 "Journal of Organization Design",
 "Journal of Cognitive Enhancement",
 "NeuroTransmitter",
 "Advances in Neurodevelopmental Disorders",
 "Management Kinderopvang",
 "Kinderopvang",
 "Health & Justice",
 "Jeugdbeleid",
 "Jeugd en Co",
 "Gender Issues",
 "Brain Informatics",
 "Human Arenas",
 "Denkbeeld",
 "Dagbesteding",
 "Culture and Brain",
 "Computational Brain & Behavior",
 "Axiomathes",
 "International Journal of Mental Health and Addiction",
 "Social Psychology of Education",
 "Annals of Dyslexia",
 "The Journal of Behavioral Health Services & Research",
 "The Australian Educational Researcher",
 "Journal of Community Health",
 "Journal of Public Health Policy",
 "Child Indicators Research",
 "Reading and Writing",
 "Journal of Clinical Psychology in Medical Settings",
 "neuropsychiatrie",
 "Journal of Family Violence",
 "Child & Youth Care Forum",
 "Learning & Behavior",
 "Journal of Child and Family Studies",
 "Community Mental Health Journal",
 "Review Journal of Autism and Developmental Disorders",
 "European Journal of Psychology of Education",
 "Applied Psychophysiology and Biofeedback",
 "Culture, Medicine, and Psychiatry",
 "Cognition,Technology & Work",
 "Neuroethics",
 "Journal of Religion and Health",
 "Child and Adolescent Social Work Journal",
 "Journal of Classification",
 "Journal of Developmental and Life-Course Criminology",
 "Race and Social Problems",
 "Biosemiotics",
 "Sexuality and Disability",
 "The Psychological Record",
 "Journal of Developmental and Physical Disabilities",
 "Social Justice Research",
 "Sleep and Biological Rhythms",
 "Psicologia: Reflexão e Crítica",
 "BioPsychoSocial Medicine",
 "Journal of Behavioral Education",
 "Journal of Rational-Emotive & Cognitive-Behavior Therapy",
 "Kölner Zeitschrift für Soziologie und Sozialpsychologie",
 "Zeitschrift für Erziehungswissenschaft",
 "Clinical Social Work Journal",
 "Der Nervenarzt",
 "Journal of Family and Economic Issues",
 "Journal of Adult Development",
 "Journal of Psycholinguistic Research",
 "Qualitative Sociology",
 "Integrative Psychological and Behavioral Science",
 "International Journal of Cognitive Therapy",
 "Ethik in der Medizin",
 "Psychotherapeut",
 "Monatsschrift Kinderheilkunde",
 "Zeitschrift für Angewandte Organisationspsychologie",
 "Forum der Psychoanalyse")

#Just check alternate forms for ones that found no records
myj4 <- c("Journal of Verbal Behavior",
         "Quality User Experience",
         "Urban Review",
         "Trends Psychology",
         "American Journal of Psychoanalysis",
         "Bulletin of Psychonomic Society",
         "Mind and Society",
         "Sexuality and Culture",
         "Computational Brain and Behavior",
         "Psychological Record",
         "Nervenartz")

myj<-c(myj,myj2,myj3,myj4)
```
Obtain session identification code. You only need do this once per session. In my experience, it sometimes fails, even when accessing the script from a valid IP address with access to Web of Science. If you are working remotely and have access to WoS, you need to use VPN.

```{r wosr.session}

require(wosr) 
#This gets the crucial session identifiers for using wosr
sid<- auth(username = NULL,
           password = NULL)


```


```{r elsevier}
myj <- c("Addictive Behaviors Reports",
"Ageing Research Reviews",
"Body Image",
"Cognitive Systems Research",
"Current Opinion in Psychology",
"Eating Behaviors",
"Emotion, Space and Society",
"International Journal of Child-Computer Interaction",
"International Journal of Clinical and Health Psychology",
"Internet Interventions",
"Journal of Behavioral and Experimental Finance",
"Journal of Choice Modelling",
"Mental Health and Physical Activity",
"Osteoporosis and Sarcopenia",
"Revista de la Educación Superior",
"Sport Management Review",
"Trends in Neuroscience and Education",
"Acta Psychologica",
"Addictive Behaviors",
"Aggression and Violent Behavior",
"Annales Médico-Psychologiques",
"Applied Ergonomics",
"Archives of Gerontology and Geriatrics",
"Behavior Therapy",
"Behaviour Research and Therapy",
"Behavioural Processes",
"Biochimica et Biophysica Acta: Molecular Basis of Disease",
"Biological Psychology",
"Brain and Cognition",
"Brain and Language",
"Child Abuse & Neglect",
"Children and Youth Services Review",
"Clinical Psychology Review",
"Clinics in Geriatric Medicine",
"Cognition",
"Cognitive and Behavioral Practice",
"Cognitive Development",
"Cognitive Psychology",
"Computers in Human Behavior",
"Computers in Human Behavior Reports",
"Consciousness and Cognition",
"Contemporary Educational Psychology",
"Current Research in Behavioral Sciences",
"Developmental Review",
"Early Childhood Research Quarterly",
"European Journal of Obstetrics & Gynecology and Reproductive Biology",
"European Journal of Trauma & Dissociation",
"European Review of Applied Psychology",
"Evolution and Human Behavior",
"Experimental Gerontology",
"Forensic Science International",
"Forensic Science International: Genetics",
"Forensic Science International: Mind and Law",
"Geriatric Nursing",
"Human Movement Science",
"Human Resource Management Review",
"Infant Behavior and Development",
"Intelligence",
"International Journal of Educational Research",
"International Journal of Human-Computer Studies",
"International Journal of Psychophysiology",
"Journal of Adolescence",
"Journal of Aging Studies",
"Journal of Anxiety Disorders",
"Journal of Applied Developmental Psychology",
"Journal of Applied Research in Memory and Cognition",
"Journal of Behavior Therapy and Experimental Psychiatry",
"Journal of Business Research",
"Journal of Business Venturing",
"Journal of Contextual Behavioral Science",
"Journal of Economic Behavior & Organization",
"Journal of Economic Psychology",
"Journal of Environmental Psychology",
"Journal of Experimental Child Psychology",
"Journal of Experimental Social Psychology",
"Journal of Family Business Strategy",
"Journal of Financial Economics",
"Journal of Forensic and Legal Medicine",
"Journal of Mathematical Psychology",
"Journal of Memory and Language",
"Journal of Neurolinguistics",
"Journal of Nutrition Education and Behavior",
"Journal of Obsessive-Compulsive and Related Disorders",
"Journal of Psychiatric Research",
"Journal of Psychosomatic Research",
"Journal of Research in Personality",
"Journal of Retailing and Consumer Services",
"Journal of School Psychology",
"Journal of Science and Medicine in Sport",
"Journal of Substance Abuse Treatment",
"Journal of the American Medical Directors Association",
"Journal of Vocational Behavior",
"Journal of World Business",
"Learning and Individual Differences",
"Learning and Motivation",
"Legal Medicine",
"Maturitas",
"Mechanisms of Ageing and Development",
"Methods in Psychology",
"Neural Networks",
"Neuropsychiatrie de l'Enfance et de l'Adolescence",
"Neuropsychologia",
"Neuroscience & Biobehavioral Reviews",
"New Ideas in Psychology",
"Nutrition",
"Nutrition Research",
"Organizational Behavior and Human Decision Processes",
"Organizational Dynamics",
"Parkinsonism & Related Disorders",
"Personality and Individual Differences",
"Pratiques Psychologiques",
"Psychologie du Travail et des Organisations",
"Psychologie Française",
"Psychology of Sport and Exercise",
"Research in Autism Spectrum Disorders",
"Research in Developmental Disabilities",
"Revista de Psicodidáctica",
"Science & Justice",
"Sexologies",
"Sleep Medicine",
"Soins: Gérontologie",
"The Arts in Psychotherapy",
"The International Journal of Management Education",
"The Internet and Higher Education",
"The Journal of Mathematical Behavior",
"The Journal of Nutritional Biochemistry",
"The Journal of Social Studies Research",
"The Lancet Healthy Longevity",
"The Leadership Quarterly",
"Transportation Research Part F: Traffic Psychology and Behaviour",
"Trends in Cognitive Sciences")


```


# WOSR Function
This function below now pulls in papers specified by a given query.  
It is advisable to use query_wos to find out how many records there are in a search - it can take hours if this is a large number, so you may want to specify an upper limit when deciding whether to proceed with search.

Next chunk now modified to find all authors with 15+ papers

```{r pullpapersfunction}

pullpapers<-function(query){
  # It's best to see how many records your query matches before actually
  # downloading the data. To do this, call query_wos before running pull_wos:
  myq<-query_wos(query, sid = sid) # shows N matching publications
  #initialise in case of zero count
  nrec<-0
  mymax<-0
  thisau<-''
  thisnum=0
  if(myq$rec_cnt>0){
    if (myq$rec_cnt<3000){
    wos_data<-pull_wos(query,sid = sid) #key instruction for pulling in data
    
    nrec<-nrow(wos_data$publication)
    myau<-wos_data$author #identify all authors
    myt<-table(myau$display_name) #tabulate frequency of authors
    mytt<-data.frame(myt)
    highcut <- 14
    w<-which(mytt$Freq> highcut) #find the authors with papers > highcut
    thisau=NA
    
    if(length(w)>0) {thisau=mytt[w,1]
    thisnum = mytt[w,2]} #thisau has all authors with 15+ papers
    }#end if myq3000
  }#end ifmy0
  return(list(myq$rec_cnt,mymax,thisau,thisnum)) #function returns N papers found, N for author with maximum N papers, and identity of that author
} 
```

The next chunk can be used to just check if the function works. You need to wait for the papers to be extracted from WoS - this occurs in two steps and can take minutes or even hours.
It is especially slow if there are any papers with more than 100 authors. 
```{r pullpaperscheck}
docheck <- 1 #change to 1 to run the check. 
if(docheck==1){
  query <- 'SO = ("Research in Autism Spectrum Disorders") AND PY = (2010) AND DT=("Article" OR "Review")'
  
  mybits<-pullpapers(query)
}
```

We'll now compare various journals. 
We have to specify a query in the correct format for wosr to recognise.
There are some examples in wosr help.


```{r makedt}
wileylist<-read.csv('wileylist.csv',stringsAsFactors=F)
myj<-wileylist[,1]
journals <- data.frame(Journal=character(),
                Narticle=integer(), 
                 Author=character(), 
                 Nau.paper=integer())


for (j in :length(myj)){
  thisj <- myj[j]
  print(j)
  print(thisj)
  mypy <- "(2015-2020)" #select range of publication years
  #DT is document type - here specify Article or Review
  query <- paste('SO = \"', thisj,'\" AND PY = ',mypy,' AND DT=(Article OR Review)')
  mybits <- pullpapers(query)
   aubits<-as.character(unlist(mybits[[3]]))
   naubit <-mybits[[4]]
   myrow<-length(aubits)
   if(myrow>0){
   addbit <- data.frame(Journal=character(myrow),
                 Narticle=integer(myrow), 
                 Author=character(myrow), 
                 Nau.paper=integer(myrow))
  addbit$Journal<-unfactor(addbit$Journal)
  addbit$Author <- unfactor(addbit$Author)
  addbit$Journal[1:myrow]<-thisj
  addbit$Narticle[1:myrow]<-unlist(mybits[1])

  addbit$Author[1:myrow]<-aubits
   addbit$Nau.paper[1:myrow]<-naubit
  journals<-rbind(journals,addbit)
   }
} #next j

journals$p_prolific <- round(100*journals$Nau.paper/journals$Narticle,2)
write.csv(journals,'wiley15b.csv',row.names=F)

```

In the next chunk, a different set of journals is used, this time looking individually at different years.  


```{r makeddy}
x <- c('International Journal of Mental Health and Addiction','Journal of Behavioral Addictions','Journal of Developmental and Physical Disabilities','Developmental Neurorehabilitation','Research in Developmental Disabilities','Research in Autism Spectrum Disorders')
y<-seq(2000,2020,1)

dy <- expand.grid(Year = y,Journal = x )
dy$Narticle<-NA
dy$Author<-NA
dy$Nmax<-NA

startrow <-1

#If you want to stop and start without losing data, you can reset startrow.
if(startrow>1){
  journaldt<-read.csv("dy.csv",stringsAsFactors=F)
}
mysearch<-startrow:nrow(dy)

for (j in mysearch){
  
  thisj <-dy$Journal[j]
  thisy <-dy$Year[j]
  print(j)
  print(thisj)
  query <- paste('SO = \"', thisj,'\" AND PY = ',thisy,' AND DT=(Article OR Review)')
  mybits <- pullpapers(query)
  dy$Narticle[j]<-unlist(mybits[1])
  dy$Author[j]<-as.character(unlist(mybits[3]))
  dy$Nmax[j]<-unlist(mybits[2])
  
}

dy$p_prolific <- round(100*dy$Nmax/dy$Narticle,2)
write.csv(dy,'journal_dy.csv',row.names=F)

```

